// Code generated by Firebird. Edit freely - this file is yours.
package handlers

import (
	"net/http"
	"strconv"
	"strings"

	"github.com/google/uuid"
	"{{ .ModulePath }}/internal/services"
)

// ParsePagination extracts pagination parameters from query string
func ParsePagination(r *http.Request) services.Pagination {
	page := 1
	perPage := 20

	if p := r.URL.Query().Get("page"); p != "" {
		if parsed, err := strconv.Atoi(p); err == nil && parsed > 0 {
			page = parsed
		}
	}

	if pp := r.URL.Query().Get("per_page"); pp != "" {
		if parsed, err := strconv.Atoi(pp); err == nil && parsed > 0 {
			perPage = parsed
		}
	}

	return services.NewPagination(page, perPage)
}

// ParseUUID extracts and validates a UUID from a string
func ParseUUID(s string) (uuid.UUID, error) {
	return uuid.Parse(s)
}

// ParseInt64ID extracts and validates an int64 ID from a string
func ParseInt64ID(s string) (int64, error) {
	return strconv.ParseInt(s, 10, 64)
}

// GetPathValue extracts path parameters from the request
func GetPathValue(r *http.Request, key string) string {
	return r.PathValue(key)
}

// GetPathUUID extracts and validates a UUID from path parameters
func GetPathUUID(r *http.Request, key string) (uuid.UUID, error) {
	return ParseUUID(r.PathValue(key))
}

// GetPathInt64 extracts and validates an int64 from path parameters
func GetPathInt64(r *http.Request, key string) (int64, error) {
	return ParseInt64ID(r.PathValue(key))
}

// ParseIncludes extracts relationship includes from ?include query parameter.
// Supports comma-separated values: ?include=author,comments
func ParseIncludes(r *http.Request) []string {
	includeParam := r.URL.Query().Get("include")
	if includeParam == "" {
		return nil
	}

	// Split by comma and trim whitespace
	includes := strings.Split(includeParam, ",")
	result := make([]string, 0, len(includes))

	for _, inc := range includes {
		trimmed := strings.TrimSpace(inc)
		if trimmed != "" {
			result = append(result, trimmed)
		}
	}

	return result
}

// TODO: Add custom parsing helpers here
// Examples:
//
// func ParseDateRange(r *http.Request) (start, end time.Time, err error) {
//     startStr := r.URL.Query().Get("start_date")
//     endStr := r.URL.Query().Get("end_date")
//     // Parse dates...
// }
//
// func ParseSortOrder(r *http.Request) string {
//     sort := r.URL.Query().Get("sort")
//     if sort == "" {
//         return "created_at" // default
//     }
//     return sort
// }
